## 10. PIVOT, UNPIVOT
### 10. PIVOT, UNPIVOT
- **PIVOT**: 행을 열로 변환(교차표 생성)
- **UNPIVOT**: 열을 행으로 변환(롱포맷 생성)
  
```
-- 샘플 테이블 생성 및 데이터 입력
CREATE TABLE sales (
  year    NUMBER,
  quarter VARCHAR2(2),
  amount  NUMBER
);

INSERT INTO sales VALUES (2023, 'Q1', 1000);
INSERT INTO sales VALUES (2023, 'Q2', 1500);
INSERT INTO sales VALUES (2023, 'Q3', 2000);
INSERT INTO sales VALUES (2023, 'Q4', 1800);
INSERT INTO sales VALUES (2024, 'Q1', 1200);
INSERT INTO sales VALUES (2024, 'Q2', 1600);

-- 1. PIVOT: 행을 열로 변환(교차표 생성)
SELECT *
FROM (
  SELECT year, quarter, amount
  FROM sales
)
PIVOT (
  SUM(amount)             -- 집계 함수
  FOR quarter             -- 피벗할 컬럼
  IN ('Q1' AS Q1, 'Q2' AS Q2, 'Q3' AS Q3, 'Q4' AS Q4)  -- 새 열 이름
);

/*
결과:
YEAR | Q1   | Q2   | Q3   | Q4
-------------------------------
2023 | 1000 | 1500 | 2000 | 1800
2024 | 1200 | 1600 | NULL | NULL
*/

-- 2. PIVOT with multiple aggregates
SELECT *
FROM sales
PIVOT (
  SUM(amount) AS sum, AVG(amount) AS avg   -- 여러 집계 함수 사용
  FOR quarter IN ('Q1', 'Q2', 'Q3', 'Q4')
);

-- 3. UNPIVOT: 열을 행으로 변환
CREATE TABLE pivoted_sales AS 
SELECT * FROM sales 
PIVOT (SUM(amount) FOR quarter IN ('Q1' AS Q1, 'Q2' AS Q2, 'Q3' AS Q3, 'Q4' AS Q4));

SELECT *
FROM pivoted_sales
UNPIVOT (
  amount                     -- 값 컬럼
  FOR quarter IN (Q1, Q2, Q3, Q4)  -- 언피벗할 컬럼
);

/*
결과:
YEAR | QUARTER | AMOUNT
-----------------------
2023 | Q1      | 1000
2023 | Q2      | 1500
2023 | Q3      | 2000
2023 | Q4      | 1800
2024 | Q1      | 1200
2024 | Q2      | 1600
*/

-- 4. 동적 PIVOT(예시: PL/SQL 사용)
-- (실행 환경에 따라 구현 방식이 크게 달라집니다)
```